<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Dashboard ‚Äî Health Analytics</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  body{
    font-family:"Inter",sans-serif;
    background:linear-gradient(120deg,#0a1020,#101b3a);
    color:#e8efff;margin:0;padding:30px;
  }
  h1{text-align:center;font-size:28px;font-weight:800;margin-bottom:30px;}
  table{width:100%;border-collapse:collapse;background:rgba(255,255,255,.05);border-radius:12px;overflow:hidden;}
  th,td{padding:12px 10px;text-align:left;}
  th{background:rgba(255,255,255,.08);color:#94a3b8;text-transform:uppercase;font-size:12px;}
  tr:nth-child(even){background:rgba(255,255,255,.04);}
  tr:hover{background:rgba(255,255,255,.1);cursor:pointer;}
  footer{text-align:center;color:#94a3b8;font-size:12px;margin-top:40px;}
  .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(6px);
         align-items:center;justify-content:center;}
  .modal-content{
    background:rgba(255,255,255,.08);border-radius:16px;padding:20px;
    max-width:700px;width:90%;box-shadow:0 0 30px rgba(0,0,0,.4);
  }
  .close{float:right;font-size:22px;cursor:pointer;}
  .btn{
    display:inline-block;margin-top:10px;background:linear-gradient(135deg,#4ade80,#22d3ee);
    color:#001b1b;padding:8px 14px;border-radius:10px;font-weight:600;text-decoration:none;
  }
  h2{margin-top:0}
</style>
</head>
<body>
<h1>üè• Admin Dashboard ‚Äî Wearable Health Analytics</h1>

<table id="patientsTable">
  <thead>
    <tr>
      <th>Patient Email</th>
      <th>Total Reports</th>
      <th>Last Report</th>
      <th>Avg HR</th>
      <th>Avg SpO‚ÇÇ</th>
      <th>Avg Temp</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="modal-content">
    <span class="close" id="closeModal">&times;</span>
    <h2>Patient Reports</h2>
    <table id="patientReportsTable" style="width:100%;border-collapse:collapse;">
      <thead>
        <tr><th>Date</th><th>HR</th><th>SpO‚ÇÇ</th><th>Temp</th><th>BP</th><th>Summary</th><th>PDF</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<footer>¬© 2025 ‚Ä¢ Smart Health Monitoring ‚Ä¢ Admin Analytics</footer>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

<script>
// -------- Firebase Config --------
const firebaseConfig = {
  apiKey: "AIzaSyEXAMPLE",
  authDomain: "your-app.firebaseapp.com",
  projectId: "your-app",
  storageBucket: "your-app.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456789:web:abc123"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// -------- Load Patient Summaries --------
const tbody=document.querySelector("#patientsTable tbody");
const modal=document.getElementById("modal");
const closeModal=document.getElementById("closeModal");
const modalBody=document.querySelector("#patientReportsTable tbody");

closeModal.onclick=()=>modal.style.display="none";
window.onclick=e=>{if(e.target===modal)modal.style.display="none";}

function average(arr){return arr.length? (arr.reduce((a,b)=>a+b,0)/arr.length).toFixed(1):"-";}

function loadPatients(){
  db.collection("reports").onSnapshot(snap=>{
    const patients={};
    snap.forEach(doc=>{
      const r=doc.data();
      const email=r.patientEmail || "unknown@patient.com";
      if(!patients[email]) patients[email]={reports:[]};
      patients[email].reports.push({...r,id:doc.id});
    });

    tbody.innerHTML="";
    Object.entries(patients).forEach(([email,data])=>{
      const reports=data.reports.sort((a,b)=>b.timestamp.localeCompare(a.timestamp));
      const last=reports[0];
      const avgHR=average(reports.map(r=>r.heartRate));
      const avgSpO2=average(reports.map(r=>r.spo2));
      const avgTemp=average(reports.map(r=>r.temperature));

      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td>${email}</td>
        <td>${reports.length}</td>
        <td>${new Date(last.timestamp).toLocaleString()}</td>
        <td>${avgHR}</td>
        <td>${avgSpO2}</td>
        <td>${avgTemp}</td>`;
      tr.addEventListener("click",()=>openPatientModal(email,reports));
      tbody.appendChild(tr);
    });
  });
}
loadPatients();

// -------- Modal: Patient Reports --------
function openPatientModal(email,reports){
  modal.style.display="flex";
  modalBody.innerHTML="";
  reports.forEach(r=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${new Date(r.timestamp).toLocaleString()}</td>
      <td>${r.heartRate}</td>
      <td>${r.spo2}</td>
      <td>${r.temperature}</td>
      <td>${r.bpSys}/${r.bpDia}</td>
      <td>${r.summary}</td>
      <td><a href="${r.pdfUrl}" target="_blank" class="btn">üìÑ</a></td>`;
    modalBody.appendChild(tr);
  });
}
</script>
</body>
</html>
