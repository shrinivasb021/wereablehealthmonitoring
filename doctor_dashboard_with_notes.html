<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Doctor Dashboard â€” Reports + Notes</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  body{
    font-family:"Inter",sans-serif;
    background:linear-gradient(120deg,#0a1020,#101b3a);
    color:#e8efff;min-height:100vh;margin:0;padding:30px;
  }
  h1{text-align:center;font-size:26px;font-weight:800;margin-bottom:30px;}
  table{width:100%;border-collapse:collapse;background:rgba(255,255,255,.05);border-radius:12px;overflow:hidden;}
  th,td{padding:12px 10px;text-align:left;}
  th{background:rgba(255,255,255,.08);color:#94a3b8;text-transform:uppercase;font-size:12px;}
  tr:nth-child(even){background:rgba(255,255,255,.04);}
  tr:hover{background:rgba(255,255,255,.1);cursor:pointer;}
  .search-box{text-align:center;margin-bottom:20px;}
  input{padding:10px 14px;border-radius:10px;border:none;width:280px;}
  .live-dot{display:inline-block;width:10px;height:10px;border-radius:50%;background:#22d3ee;box-shadow:0 0 8px #22d3ee;margin-left:6px;}
  footer{text-align:center;color:#94a3b8;font-size:12px;margin-top:40px;}
  /* Modal */
  #modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(6px);align-items:center;justify-content:center;}
  .modal-content{
    background:rgba(255,255,255,.08);
    border-radius:16px;padding:20px;max-width:600px;width:90%;box-shadow:0 0 30px rgba(0,0,0,.4);
  }
  .close{float:right;font-size:22px;cursor:pointer;}
  .btn{
    display:inline-block;margin-top:12px;background:linear-gradient(135deg,#4ade80,#22d3ee);
    color:#001b1b;padding:8px 14px;border-radius:10px;font-weight:600;text-decoration:none;
  }
  textarea{
    width:100%;min-height:80px;margin-top:8px;padding:10px;border-radius:10px;
    border:none;font-family:inherit;font-size:14px;background:rgba(255,255,255,.1);color:#fff;
  }
  canvas{background:#fff;border-radius:10px;margin-top:10px;}
  .save-note{margin-top:10px;}
</style>
</head>
<body>
<h1>Doctor Dashboard <span class="live-dot"></span></h1>

<div class="search-box">
  <input id="searchInput" type="text" placeholder="ðŸ”Ž Search reports...">
</div>

<table id="reportsTable">
  <thead>
    <tr>
      <th>Date</th><th>HR</th><th>SpOâ‚‚</th><th>Temp</th><th>BP</th><th>Summary</th><th>Notes</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- Modal -->
<div id="modal">
  <div class="modal-content">
    <span class="close" id="closeModal">&times;</span>
    <h2>Patient Report</h2>
    <p id="mTime"></p>
    <p><b>Heart Rate:</b> <span id="mHr"></span> bpm</p>
    <p><b>SpOâ‚‚:</b> <span id="mSpo2"></span>%</p>
    <p><b>Temperature:</b> <span id="mTemp"></span> Â°C</p>
    <p><b>Blood Pressure:</b> <span id="mBp"></span> mmHg</p>
    <p><b>Summary:</b> <span id="mSummary"></span></p>
    <a id="mPdf" class="btn" target="_blank">ðŸ“„ View PDF</a>

    <h3 style="margin-top:16px;">ðŸ©º Doctor Notes</h3>
    <textarea id="mNotes" placeholder="Write your observations here..."></textarea>
    <button class="btn save-note" id="saveNoteBtn">ðŸ’¾ Save Notes</button>
    <canvas id="trendChart" height="100"></canvas>
  </div>
</div>

<footer>Â© 2025 â€¢ Wearable Health Monitoring â€¢ Doctor Dashboard + Notes</footer>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// -------- Firebase Config --------
const firebaseConfig = {
  apiKey: "AIzaSyEXAMPLE",
  authDomain: "your-app.firebaseapp.com",
  projectId: "your-app",
  storageBucket: "your-app.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456789:web:abc123"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// -------- Display Reports --------
const tbody=document.querySelector("#reportsTable tbody");
function renderRow(id,report){
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td>${new Date(report.timestamp).toLocaleString()}</td>
    <td>${report.heartRate}</td>
    <td>${report.spo2}</td>
    <td>${report.temperature}</td>
    <td>${report.bpSys}/${report.bpDia}</td>
    <td>${report.summary}</td>
    <td>${report.doctorNote?report.doctorNote.slice(0,25)+'...':'â€”'}</td>`;
  tr.addEventListener("click",()=>openModal(id,report));
  return tr;
}

db.collection("reports").orderBy("timestamp","desc").onSnapshot(snap=>{
  tbody.innerHTML="";
  snap.forEach(doc=>{
    tbody.appendChild(renderRow(doc.id,doc.data()));
  });
});

// -------- Search --------
document.getElementById("searchInput").addEventListener("input",e=>{
  const term=e.target.value.toLowerCase();
  [...tbody.querySelectorAll("tr")].forEach(r=>{
    r.style.display=r.textContent.toLowerCase().includes(term)?"":"none";
  });
});

// -------- Modal --------
const modal=document.getElementById("modal");
const closeModal=document.getElementById("closeModal");
closeModal.onclick=()=>modal.style.display="none";
window.onclick=e=>{if(e.target===modal)modal.style.display="none";}
let currentReportId=null;

function openModal(id,report){
  modal.style.display="flex";
  currentReportId=id;
  document.getElementById("mTime").textContent=new Date(report.timestamp).toLocaleString();
  document.getElementById("mHr").textContent=report.heartRate;
  document.getElementById("mSpo2").textContent=report.spo2;
  document.getElementById("mTemp").textContent=report.temperature;
  document.getElementById("mBp").textContent=`${report.bpSys}/${report.bpDia}`;
  document.getElementById("mSummary").textContent=report.summary;
  document.getElementById("mPdf").href=report.pdfUrl;
  document.getElementById("mNotes").value=report.doctorNote||"";

  const ctx=document.getElementById("trendChart").getContext("2d");
  new Chart(ctx,{
    type:"bar",
    data:{
      labels:["HR","SpOâ‚‚","Temp","BP Sys","BP Dia"],
      datasets:[{
        data:[report.heartRate,report.spo2,report.temperature,report.bpSys,report.bpDia],
        backgroundColor:["#60a5fa","#34d399","#fbbf24","#f43f5e","#fb7185"]
      }]
    },
    options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}
  });
}

// -------- Save Notes --------
document.getElementById("saveNoteBtn").addEventListener("click",async()=>{
  const note=document.getElementById("mNotes").value.trim();
  if(!currentReportId)return;
  await db.collection("reports").doc(currentReportId).update({doctorNote:note});
  alert("âœ… Note saved successfully!");
  modal.style.display="none";
});
</script>
</body>
</html>
